<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FurniCraft - Customize Your Furniture</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      min-height: 100vh;
      color: #2c3e50;
      line-height: 1.6;
    }

    /* Professional Header */
    header {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);
      color: white;
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.5rem;
      font-weight: 600;
      font-family: 'Playfair Display', serif;
      box-shadow: 0 4px 20px rgba(139, 69, 19, 0.3);
      position: relative;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="wood" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><rect width="20" height="20" fill="%23A0522D"/><path d="M0,10 Q5,8 10,10 T20,10" stroke="%23D2691E" stroke-width="0.5" fill="none"/><path d="M0,15 Q5,13 10,15 T20,15" stroke="%23CD853F" stroke-width="0.3" fill="none"/></pattern></defs><rect width="100" height="100" fill="url(%23wood)"/></svg>');
      opacity: 0.1;
      pointer-events: none;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.8rem;
    }

    .logo::before {
      content: 'ü™ë';
      font-size: 2rem;
    }

    #user {
      background: rgba(255, 255, 255, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 25px;
      font-size: 0.9rem;
      backdrop-filter: blur(10px);
    }

    /* Main Content */
    main {
      padding: 3rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .page-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .page-header h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2.5rem;
      color: #8B4513;
      margin-bottom: 1rem;
    }

    .page-header p {
      font-size: 1.1rem;
      color: #6c757d;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Customization Container */
    .customization-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      margin-bottom: 3rem;
    }

    .selected-item {
      background: linear-gradient(145deg, #ffffff, #f8f9fa);
      border-radius: 20px;
      padding: 2rem;
      text-align: center;
      border: 1px solid rgba(139, 69, 19, 0.1);
      box-shadow: 0 10px 30px rgba(139, 69, 19, 0.1);
    }

    .item-image {
      width: 150px;
      height: 150px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid #8B4513;
    }

    .item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .item-image2 {
      width: 120px;
      height: 120px;
      margin: 0 auto 1.5rem;
      border-radius: 15px;
      overflow: hidden;
      border: 2px solid #8B4513;
    }

    .item-image2 img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .selected-item h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }

    .selected-item .material {
      color: #8B4513;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .material-parts {
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: #495057;
    }

    .material-parts div {
      margin-bottom: 0.5rem;
    }

    .item-gif {
      width: 200px;
      height: 200px;
      margin: 1rem auto;
      display: block;
      border-radius: 10px;
      border: 2px solid #8B4513;
    }

    .customization-options {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      border: 1px solid rgba(139, 69, 19, 0.1);
      box-shadow: 0 10px 30px rgba(139, 69, 19, 0.1);
    }

    .customization-options h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: #8B4513;
      margin-bottom: 2rem;
      text-align: center;
    }

    .option-group {
      margin-bottom: 2rem;
    }

    .option-group label {
      display: block;
      font-weight: 600;
      color: #495057;
      margin-bottom: 0.5rem;
    }

    .option-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .option-card {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 1rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .option-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .option-card.selected {
      border-color: #8B4513;
      background: linear-gradient(135deg, #8B4513, #CD853F);
      color: white;
    }

    .color-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin: 0 auto 0.5rem;
      border: 2px solid #dee2e6;
    }

    .option-card.selected .color-option {
      border-color: white;
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }

    .quantity-btn {
      background: #8B4513;
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .quantity-btn:hover {
      background: #A0522D;
      transform: scale(1.1);
    }

    .quantity-input {
      width: 60px;
      text-align: center;
      padding: 0.5rem;
      border: 1px solid #dee2e6;
      border-radius: 5px;
      font-size: 1.1rem;
    }



    .proceed-btn {
      background: linear-gradient(135deg, #8B4513, #CD853F);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 25px;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 2rem;
      width: 100%;
    }

    .proceed-btn:hover {
      background: linear-gradient(135deg, #A0522D, #D2691E);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(139, 69, 19, 0.3);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .customization-container {
        grid-template-columns: 1fr;
        gap: 2rem;
      }

      main {
        padding: 2rem 1rem;
      }

      .page-header h1 {
        font-size: 2rem;
      }

      .option-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      }
    }

    /* Animations */
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    .price-notice {
      font-size: 1rem;
      color: #8B4513;
      font-weight: 500;
      text-align: center;
      margin-top: 0.2rem;
      font-style: italic;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <header>
    <div style="display: flex; align-items: center;">
      <button onclick="window.history.back()" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; margin-right: 1rem;">‚Üê Back</button>
      <div class="logo">FurniCraft</div>
    </div>
    <span id="user">Welcome!</span>
  </header>

  <main>
    <div class="page-header">
      <h1>Customize Your Furniture</h1>
      <p>Personalize your selected piece with premium finishes, colors, and options to make it uniquely yours.</p>
    </div>

    <div class="customization-container fade-in">
        <div class="selected-item">
        <div id="itemImage" class="item-image"></div>
        <h2 id="itemName"></h2>
        <div id="itemImage2" class="item-image2"></div>
        <div class="material" id="itemMaterial"></div>
        <div id="materialParts" class="material-parts"></div>
        <div id="shapeParts" class="material-parts"></div>
        <p id="itemDescription"></p>
        <img id="itemGif" class="item-gif" src="" alt="Furniture Animation">

        <div class="custom-description" style="margin-top: 1rem; text-align: left;">
          <label for="customDescription" style="display: block; font-weight: 600; color: #495057; margin-bottom: 0.5rem;">Additional Design Notes:</label>
          <textarea id="customDescription" rows="3" placeholder="Enter any additional design notes or descriptions for your furniture..." style="width: 100%; padding: 0.5rem; border: 1px solid #dee2e6; border-radius: 5px; font-family: inherit; resize: vertical;"></textarea>
        </div>
      </div>

      <div class="customization-options">
        <h3>Customization Options</h3>

        <div class="option-group">
          <label>Color:</label>
          <div style="display: flex; align-items: center; gap: 1rem;">
            <input type="color" id="colorPicker" value="#D2B48C" oninput="selectCustomColor(this.value)" style="width: 60px; height: 60px; border: none; cursor: pointer; background: none;">
            <span id="colorValue" style="font-family: monospace; font-size: 1.1rem;">#D2B48C</span>
          </div>
          <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">Select any color for your furniture finish.</p>
        </div>

        <div class="option-group">
          <label>Finish:</label>
          <div class="option-grid">
            <div class="option-card" data-category="finish" onclick="selectOption('finish', 'matte')">
              <div style="width: 40px; height: 40px; background: #d4d4d4; border-radius: 50%; margin: 0 auto 0.5rem; border: 2px solid #bbb;"></div>
              <span>Matte</span>
            </div>
            <div class="option-card selected" data-category="finish" onclick="selectOption('finish', 'glossy')">
              <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #fff, #e0e0e0); border-radius: 50%; margin: 0 auto 0.5rem; border: 2px solid #bbb; box-shadow: inset 0 0 10px rgba(255,255,255,0.5);"></div>
              <span>Glossy</span>
            </div>
            <div class="option-card" data-category="finish" onclick="selectOption('finish', 'satin')">
              <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f0f0f0, #d0d0d0); border-radius: 50%; margin: 0 auto 0.5rem; border: 2px solid #bbb;"></div>
              <span>Satin</span>
            </div>
            <div class="option-card" data-category="finish" onclick="selectOption('finish', 'semi-gloss')">
              <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f8f8f8, #d8d8d8); border-radius: 50%; margin: 0 auto 0.5rem; border: 2px solid #bbb; box-shadow: inset 0 0 5px rgba(255,255,255,0.7);"></div>
              <span>Semi-Gloss</span>
            </div>
            <div class="option-card" data-category="finish" onclick="selectOption('finish', 'distressed')">
              <div style="width: 40px; height: 40px; background: #c0a080; border-radius: 50%; margin: 0 auto 0.5rem; border: 2px solid #bbb; position: relative;"></div>
              <span>Distressed</span>
            </div>
          </div>
        </div>

        <div class="option-group">
          <label>Size:</label>
          <div class="option-grid">
            <div class="option-card" data-category="size" onclick="selectOption('size', 'compact')">
              <span style="font-size: 1.5rem;">üìê</span><br>
              <span>Compact</span><br>
              <small style="font-size: 0.8rem; color: #6c757d;">6x12 ft</small>
            </div>
            <div class="option-card selected" data-category="size" onclick="selectOption('size', 'standard')">
              <span style="font-size: 1.5rem;">üìè</span><br>
              <span>Standard</span><br>
              <small style="font-size: 0.8rem; color: #6c757d;">8x16 ft</small>
            </div>
            <div class="option-card" data-category="size" onclick="selectOption('size', 'large')">
              <span style="font-size: 1.5rem;">üìè</span><br>
              <span>Large</span><br>
              <small style="font-size: 0.8rem; color: #6c757d;">10x20 ft</small>
            </div>
          </div>
        </div>

        <div class="option-group">
          <label>Quantity:</label>
          <div class="quantity-selector">
            <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
            <input type="number" id="quantity" class="quantity-input" value="1" min="1" max="10">
            <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
          </div>
        </div>

        <div id="itemPrice" class="price" style="font-size: 1.5rem; font-weight: 700; color: #8B4513; text-align: center; margin: 1rem 0;"></div>
        <p class="price-notice">Prices may vary depends on the furniture shops</p>

        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
          <button class="proceed-btn" onclick="saveAsPNG()" style="flex: 1;">Save as PNG</button>
          <button class="proceed-btn" onclick="proceedToOrder()" style="flex: 1;">Send to Furniture Shop</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // All materials data (same as in craft.html)
    const allMaterials = {
      narra: { name: 'Narra Wood', description: 'Exotic Philippine hardwood with rich reddish-brown color', priceModifier: '+$200', icon: 'üå≥', durability: 90, quality: 95 },
      aninapla: { name: 'Aninapla Wood', description: 'Dark brown hardwood known for its durability', priceModifier: '+$100', icon: 'üå≤', durability: 85, quality: 90 },
      mahogany: { name: 'Mahogany Wood', description: 'Classic hardwood with deep red tones and fine grain', priceModifier: '+$150', icon: 'ü™µ', durability: 88, quality: 92 },
      steel: { name: 'Stainless Steel', description: 'Modern and durable metal construction', priceModifier: '+$200', icon: '‚öôÔ∏è', durability: 95, quality: 85 },
      aluminum: { name: 'Aluminum', description: 'Lightweight metal with sleek finish', priceModifier: '+$100', icon: 'üîß', durability: 80, quality: 80 },
      fabric: { name: 'Premium Fabric', description: 'Soft and comfortable upholstery', priceModifier: '+$75', icon: 'üõèÔ∏è', durability: 60, quality: 70 },
      leather: { name: 'Genuine Leather', description: 'Luxurious genuine leather upholstery', priceModifier: '+$300', icon: 'ü™ë', durability: 75, quality: 90 },
      plastic: { name: 'High-Grade Plastic', description: 'Durable and easy to clean', priceModifier: '-$25', icon: 'ü™ü', durability: 70, quality: 65 }
    };

    // Set user name from session storage
    const userName = sessionStorage.getItem('username');
    if (userName) {
      document.getElementById('user').textContent = `Welcome, ${userName}!`;
    }

    // Get selected furniture and material from session storage
    const selectedFurniture = JSON.parse(sessionStorage.getItem('selectedFurniture') || '{}');
    const selectedMaterials = JSON.parse(sessionStorage.getItem('selectedMaterials') || '{}');
    const selectedShapes = JSON.parse(sessionStorage.getItem('selectedShapes') || '{}');
    const isCombined = sessionStorage.getItem('isCombined') === 'true';

    // Initialize customizations with defaults or session values
    let customizations = {
      finish: 'glossy',
      color: 'natural',
      size: 'standard',
      quantity: 1
    };

    // Global variable for current price
    let currentPrice = 0;

    // Color mapping for visual updates (matches UI colors)
    const colorMap = {
      natural: 'transparent', 
      dark: '#654321',
      light: '#F5DEB3',
      ebony: '#2F1B14',
      cherry: '#8B0000',
      walnut: '#3C2F2F',
      mahogany: '#C04000',
      teak: '#A67B5B',
      maple: '#F5F5DC'
    };

    // Function to update visual preview
    function updateVisuals() {
      const img = document.getElementById('previewImg');
      const overlay = document.getElementById('colorOverlay');
      
      if (!img || !overlay) return;

      // 1. Update Color (Tint)
      let color = colorMap[customizations.color];
      if (!color && customizations.color.startsWith('#')) {
        color = customizations.color;
      }
      color = color || 'transparent';
      overlay.style.backgroundColor = color;
      // Only apply opacity if a color is selected (not natural)
      overlay.style.opacity = customizations.color === 'natural' ? '0' : '0.5';

      // 2. Update Finish (CSS Filters)
      let filter = '';
      switch (customizations.finish) {
        case 'matte':
          filter = 'contrast(0.9) brightness(1.05)';
          break;
        case 'glossy':
          filter = 'contrast(1.1) saturate(1.2) brightness(1.1)';
          break;
        case 'satin':
          filter = 'contrast(1.0) sepia(0.1)';
          break;
        case 'semi-gloss':
          filter = 'contrast(1.05) brightness(1.02)';
          break;
        case 'distressed':
          filter = 'sepia(0.4) contrast(1.2) brightness(0.9)';
          break;
        default:
          filter = 'none';
      }
      img.style.filter = filter;

      // 3. Update Size (Transform Scale)
      let scale = 1;
      if (customizations.size === 'compact') scale = 0.85;
      if (customizations.size === 'large') scale = 1.15;
      img.style.transform = `scale(${scale})`;
    }

    // Function to update price based on customizations
    function updatePrice() {
      // Base price from selectedFurniture or default
      let basePrice = selectedFurniture.price ? parseInt(selectedFurniture.price.replace('‚Ç±', '')) : 5000; // Default ‚Ç±5000 if not set

      // Customization costs
      const colorCosts = {
        natural: 0,
        dark: 500,
        light: 300,
        ebony: 800,
        cherry: 600,
        walnut: 700,
        mahogany: 900,
        teak: 750,
        maple: 650
      };

      const finishCosts = {
        matte: 0,
        glossy: 200,
        satin: 150,
        'semi-gloss': 250,
        distressed: 400
      };

      const sizeCosts = {
        standard: 0,
        compact: -300,
        large: 1000
      };

      let colorCost = colorCosts[customizations.color];
      if (colorCost === undefined) {
        colorCost = customizations.color.startsWith('#') ? 500 : 0;
      }
      const finishCost = finishCosts[customizations.finish] || 0;
      const sizeCost = sizeCosts[customizations.size] || 0;

      currentPrice = basePrice + colorCost + finishCost + sizeCost;
      const totalPrice = currentPrice * customizations.quantity;

      document.getElementById('itemPrice').textContent = `‚Ç±${totalPrice.toLocaleString()}`;
    }

    // Custom function to get combined material names and icons
    function getCombinedMaterialInfo(materials, isCombined) {
      if (!materials || Object.keys(materials).length === 0) {
        return { names: 'Not selected', icons: 'üì¶', description: 'No material selected.' };
      }
      if (!isCombined) {
        // Single material
        const mat = materials.all;
        const materialData = allMaterials[mat.type];
        return {
          names: mat.name,
          icons: materialData ? materialData.icon : 'üì¶',
          description: mat.description
        };
      } else {
        // Combined
        const names = Object.keys(materials).map(part => {
          const key = materials[part];
          return allMaterials[key] ? allMaterials[key].name : key;
        }).join(' + ');
        const icons = Object.keys(materials).map(part => {
          const key = materials[part];
          return allMaterials[key] ? allMaterials[key].icon : 'üì¶';
        }).join(' ');
        return {
          names,
          icons,
          description: 'Combined materials for different parts.'
        };
      }
    }

    // Furniture image from selectedFurniture.image or fallback
    const furnitureImageSrc = selectedFurniture.image || 'images/chair.jpg';

    // Display selected item
    if (selectedFurniture.name) {
      document.getElementById('itemName').textContent = selectedFurniture.name;
      const materialInfo = getCombinedMaterialInfo(selectedMaterials, isCombined);
      document.getElementById('itemImage2').innerHTML = `<div style="font-size: 3rem; display: flex; align-items: center; justify-content: center; height: 100%;">${materialInfo.icons}</div>`;
      document.getElementById('itemMaterial').textContent = `Material: ${materialInfo.names}`;
      document.getElementById('itemDescription').textContent = materialInfo.description;

      // Display material parts breakdown for combined materials
      if (isCombined) {
        const partsHtml = Object.keys(selectedMaterials).map(part => {
          const matKey = selectedMaterials[part];
          const matName = allMaterials[matKey] ? allMaterials[matKey].name : matKey;
          return `<div><strong>${part.charAt(0).toUpperCase() + part.slice(1)}:</strong> ${matName}</div>`;
        }).join('');
        document.getElementById('materialParts').innerHTML = partsHtml;
      } else {
        document.getElementById('materialParts').innerHTML = '';
      }

      // Display shape parts breakdown for combined materials
      if (isCombined) {
        const shapesHtml = Object.keys(selectedShapes).map(part => {
          const shape = selectedShapes[part];
          return `<div><strong>${part.charAt(0).toUpperCase() + part.slice(1)} Shape:</strong> ${shape}</div>`;
        }).join('');
        document.getElementById('shapeParts').innerHTML = shapesHtml;
      } else {
        document.getElementById('shapeParts').innerHTML = '';
      }

      document.getElementById('itemImage').innerHTML = `
        <div style="position: relative; width: 100%; height: 100%;">
          <img id="previewImg" src="${furnitureImageSrc}" alt="${selectedFurniture.name}" style="width: 100%; height: 100%; object-fit: cover; transition: all 0.3s ease;">
          <div id="colorOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; mix-blend-mode: multiply; pointer-events: none; transition: background-color 0.3s ease;"></div>
        </div>`;

      // Set GIF based on furniture type
      const gifMap = {
        bed: 'images/GIF_bed.gif',
        chair: 'images/GIF_chair.gif',
        desk: 'images/GIF_desk.gif',
        sofa: 'images/GIF_sofa.gif',
        stool: 'images/GIF_stool.gif',
        table: 'images/GIF_table.gif'
      };
      const gifSrc = gifMap[selectedFurniture.type];
      if (gifSrc) {
        document.getElementById('itemGif').src = gifSrc;
        document.getElementById('itemGif').style.display = 'block';
      } else {
        document.getElementById('itemGif').style.display = 'none';
      }

      updatePrice();
      updateVisuals(); // Initial visual update
    } else {
      // If no selection, redirect back
      alert('No furniture selected. Please go back and select a piece.');
      window.history.back();
    }



    // Select option
    function selectOption(category, value) {
      // Remove previous selection
      document.querySelectorAll(`.option-card[data-category="${category}"]`).forEach(card => {
        card.classList.remove('selected');
      });

      // Add selection to clicked card
      const clickedCard = event.target.closest('.option-card');
      clickedCard.classList.add('selected');

      customizations[category] = value;

      updatePrice();
      updateVisuals(); // Trigger visual update on selection
    }

    // Handle Custom Color Selection
    function selectCustomColor(hex) {
      customizations.color = hex;
      document.getElementById('colorValue').textContent = hex;
      updatePrice();
      updateVisuals();
    }

    // Change quantity
    function changeQuantity(delta) {
      const quantityInput = document.getElementById('quantity');
      let quantity = parseInt(quantityInput.value) + delta;
      quantity = Math.max(1, Math.min(10, quantity));
      quantityInput.value = quantity;
      customizations.quantity = quantity;
      updatePrice();
    }

    // Update quantity from input
    document.getElementById('quantity').addEventListener('change', function() {
      let quantity = parseInt(this.value);
      quantity = Math.max(1, Math.min(10, quantity));
      this.value = quantity;
      customizations.quantity = quantity;
      updatePrice();
    });



    // Proceed to order
    function proceedToOrder() {
      // Store customizations in session storage
      sessionStorage.setItem('customizations', JSON.stringify(customizations));
      const totalPrice = currentPrice * customizations.quantity;
      sessionStorage.setItem('totalPrice', `‚Ç±${totalPrice.toLocaleString()}`);
      sessionStorage.setItem('customDescription', document.getElementById('customDescription').value);
      sessionStorage.setItem('selectedShapes', JSON.stringify(selectedShapes));

      // Save proposal to localStorage for admin view
      const proposal = {
        customer: userName || 'Anonymous',
        selectedFurniture,
        selectedMaterials,
        selectedShapes,
        isCombined,
        customizations,
        totalPrice: `‚Ç±${totalPrice.toLocaleString()}`,
        customDescription: document.getElementById('customDescription').value,
        date: new Date().toISOString()
      };
      let proposals = JSON.parse(localStorage.getItem('proposals')) || [];
      proposals.push(proposal);
      localStorage.setItem('proposals', JSON.stringify(proposals));

      // Redirect to shop selection page
      window.location.href = 'shop.html';
    }

    // Save as PNG
    function saveAsPNG() {
      html2canvas(document.querySelector('.customization-container')).then(canvas => {
        const link = document.createElement('a');
        link.download = 'customized-furniture.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      }).catch(error => {
        console.error('Error generating PNG:', error);
        alert('Failed to generate PNG. Please try again.');
      });
    }

    // Add fade-in animation
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelector('.customization-container').classList.add('fade-in');
    });
  </script>
</body>
</html>
